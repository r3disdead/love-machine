<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LOVE MACHINE</title>
<style>
    body{margin:0;background:#000;color:#fff;font-family:'Comic Sans MS',cursive;height:100vh;display:flex;flex-direction:column;overflow:hidden;position:relative;}
    h1{margin:20px 0 10px;text-align:center;font-size:120px;color:#ff1493;text-shadow:0 0 50px #ff1493,0 0 100px #ff69b4;letter-spacing:12px;}

    #input-zone{
        position:absolute;top:70px;right:30px;display:flex;flex-direction:column;gap:12px;align-items:flex-end;z-index:999;
    }
    label{font-size:22px;color:#ff69b4;}
    input{background:#111;border:3px solid #ff1493;padding:14px;font-size:18px;width:540px;color:#ff69b4;text-align:center;border-radius:12px;}
    button{background:#ff1493;color:#000;border:none;padding:14px 32px;border-radius:12px;font-weight:bold;cursor:pointer;font-size:16px;}
    button:hover{background:#ff69b4;}

    #main{flex:1;display:flex;align-items:center;justify-content:center;position:relative;}

    #instructions{
        font-size:26px;color:#ff69b4;line-height:1.9;text-shadow:0 0 18px #ff1493;opacity:0;transition:opacity 0.7s;
        position:absolute;left:50%;margin-left:-800px;top:50%;transform:translateY(-50%);text-align:left;
        pointer-events:none;z-index:10;max-width:300px;
    }
    #instructions.visible{opacity:1;}

    #game-frame{width:832px;height:632px;position:relative;}
    #game{
        position:absolute;top:16px;left:16px;width:800px;height:600px;
        border:16px solid #ff1493;border-radius:36px;overflow:hidden;
        box-shadow:0 0 120px #ff1493,inset 0 0 90px rgba(255,20,147,0.8);background:#000;
    }
    #scene-svg,#character-svg{position:absolute;top:0;left:0;width:800px;height:600px;}
    #character-svg{z-index:10;pointer-events:none;}

    /* Cœurs volants temporaires */
    .heart-fly{
        position:absolute;font-size:72px;color:#ff1493;text-shadow:0 0 45px #ff69b4;
        pointer-events:none;z-index:20;
        animation:cosmicFly 2.2s ease-out forwards;
    }

    /* Cœurs qui restent posés pour toujours et deviennent des "sources d’amour" */
    .heart-permanent{
        position:absolute;font-size:64px;color:#ff1493;text-shadow:0 0 40px #ff69b4, 0 0 80px #ff1493;
        pointer-events:none;z-index:15;opacity:0.9;
        animation:pulse 3s infinite alternate;
    }

    @keyframes cosmicFly{
        0%   {transform:scale(0.8) rotate(0deg);opacity:1;}
        50%  {transform:scale(1.5) rotate(720deg);opacity:1;}
        100% {transform:translate(var(--dx),var(--dy)) rotate(1080deg) scale(0.4);opacity:0.5;}
    }
    @keyframes pulse{
        from {transform:scale(1);text-shadow:0 0 40px #ff69b4, 0 0 80px #ff1493;}
        to   to {transform:scale(1.3);text-shadow:0 0 70px #ff69b4, 0 0 140px #ff1493;}
    }
</style>
</head>
<body>

<h1>LOVE MACHINE</h1>

<div id="input-zone">
    <label>Your lovely inscription ID</label>
    <input type="text" id="inscriptionId" placeholder="paste a full love_message ID + press Enter">
    <button onclick="loadInscription()">LOAD</button>
</div>

<div id="main">
    <div id="instructions">
        ← → Move<br>
        ↑ Jump<br>
        ENTER : SEND LOVE !
    </div>

    <div id="game-frame">
        <div id="game" tabindex="0">
            <svg id="scene-svg" viewBox="0 0 800 600"></svg>
            <svg id="character-svg" viewBox="0 0 800 600"></svg>
        </div>
    </div>
</div>

<script>
    const game      = document.getElementById('game');
    const charSvg   = document.getElementById('character-svg');
    const instructions = document.getElementById('instructions');
    const input     = document.getElementById('inscriptionId');

    let x = 0, y = 0, vy = 0, jumping = false;
    const keys = {};
    let lastShot = 0;

    const MIN_X = -700;
    const MAX_X = 700;

    // Tableau des cœurs permanents (qui vont régénérer de l’amour)
    const loveSources = [];

    async function loadInscription() {
        // … (ton code de chargement inchangé) …
        const id = input.value.trim();
        if (!id) return;
        try {
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://ordinals.com/content/' + id)}`;
            const resp = await fetch(proxyUrl);
            const data = await resp.json();
            let svgText = data.contents;
            svgText = svgText.replace(/href="\/content\//g, 'href="https://ordinals.com/content/');
            const parser = new DOMParser();
            const doc = parser.parseFromString(svgText, 'image/svg+xml');
            const images = doc.querySelectorAll('image');
            if (images.length < 6) return;

            const sceneHTML = Array.from(images).slice(0, -1).map(img => 
                `<image href="${img.getAttribute('href')}" width="800" height="600"/>`).join('');
            const charHref = images[images.length-1].getAttribute('href');

            document.getElementById('scene-svg').innerHTML = sceneHTML;
            document.getElementById('character-svg').innerHTML = `
                <defs><mask id="mask"><image href="${charHref}" width="800" height="600" style="filter:brightness(30);"/></mask></defs>
                <image href="${charHref}" width="800" height="600" mask="url(#mask)"/>`;

            instructions.classList.add('visible');
            game.focus();
            x = y = 0;
        } catch(e){ console.error(e); }
    }

    function shoot() {
        if (Date.now() - lastShot < 80) return;
        lastShot = Date.now();

        // Position exacte du perso dans la page (important !)
        const rect = game.getBoundingClientRect();
        const charCenterX = rect.left + 400 + x;   // 400 = moitié de 800px
        const charCenterY = rect.top + 540 + y;    // un peu en bas du perso

        // 1. Cœur volant temporaire (traverse tout l’écran)
        const fly = document.createElement('div');
        fly.className = 'heart-fly';
        fly.textContent = '♥';
        fly.style.left = charCenterX + 'px';
        fly.style.top  = charCenterY + 'px';

        const dx = (Math.random() - 0.5) * 2400;   // très loin
        const dy = (Math.random() - 0.5) * 1800;
        fly.style.setProperty('--dx', dx + 'px');
        fly.style.setProperty('--dy', dy + 'px');
        document.body.appendChild(fly);
        setTimeout(() => fly.remove(), 2400);

        // 2. 30% de chance qu’un cœur reste posé pour toujours
        if (Math.random() < 0.3) {
            const perm = document.createElement('div');
            perm.className = 'heart-permanent';
            perm.textContent = '♥';
            // position finale du cœur volant = position où il "atterrit"
            perm.style.left = (charCenterX + dx) + 'px';
            perm.style.top  = (charCenterY + dy) + 'px';
            document.body.appendChild(perm);
            loveSources.push(perm);
        }

        // 3. Tous les cœurs permanents déjà posés régénèrent un petit cœur à chaque tir
        loveSources.forEach(source => {
            const mini = document.createElement('div');
            mini.className = 'heart-fly';
            mini.textContent = '♥';
            mini.style.fontSize = '48px';
            mini.style.left = source.style.left;
            mini.style.top  = source.style.top;

            const miniDx = (Math.random() - 0.5) * 1200;
            const miniDy = (Math.random() - 0.5) * 1000;
            mini.style.setProperty('--dx', miniDx + 'px');
            mini.style.setProperty('--dy', miniDy + 'px');
            document.body.appendChild(mini);
            setTimeout(() => mini.remove(), 2400);
        });
    }

    function loop() {
        if (keys.ArrowLeft) x -= 24;
        if (keys.ArrowRight) x += 24;
        x = Math.max(MIN_X, Math.min(MAX_X, x));

        if (jumping) {
            y += vy;
            vy += 1.1;
            if (y >= 0 && vy >= 0) { y = 0; jumping = false; vy = 0; }
        }

        if (keys.Enter) shoot();

        charSvg.style.transform = `translate(${x}px, ${y}px)`;
        requestAnimationFrame(loop);
    }

    game.addEventListener('keydown', e => {
        keys[e.code] = true;
        if (e.code === 'ArrowUp' && !jumping) { jumping = true; vy = -28; e.preventDefault(); }
        if (e.code === 'Enter') e.preventDefault();
    });
    game.addEventListener('keyup', e => keys[e.code] = false);

    input.addEventListener('keypress', e => { if (e.key === 'Enter') loadInscription(); });

    requestAnimationFrame(loop);
</script>
</body>
</html>

