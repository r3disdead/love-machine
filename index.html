<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LOVE MACHINE</title>
<style>
    body{margin:0;background:#000;color:#fff;font-family:'Comic Sans MS',cursive;height:100vh;display:flex;flex-direction:column;overflow:hidden;}
    h1{margin:20px 0 10px;text-align:center;font-size:120px;color:#ff1493;text-shadow:0 0 50px #ff1493,0 0 100px #ff69b4;letter-spacing:12px;}

    #input-zone{
        position:absolute;top:70px;right:30px;display:flex;flex-direction:column;gap:12px;align-items:flex-end;z-index:999;
    }
    label{font-size:22px;color:#ff69b4;}
    input{
        background:#111;border:3px solid #ff1493;padding:14px;font-size:18px;width:540px;color:#ff69b4;
        text-align:center;border-radius:12px;
    }
    button{
        background:#ff1493;color:#000;border:none;padding:14px 32px;border-radius:12px;
        font-weight:bold;cursor:pointer;font-size:16px;
    }
    button:hover{background:#ff69b4;}

    #main{
        flex:1;display:flex;align-items:center;justify-content:center;position:relative;
    }

    /* === INSTRUCTIONS DÉCALÉES SUR LA GAUCHE (sans chevauchement) === */
    #instructions{
        font-size:26px;color:#ff69b4;line-height:1.9;
        text-shadow:0 0 18px #ff1493;
        opacity:0;
        transition:opacity 0.7s;
        position:absolute;
        left:50%;
        margin-left:-800px; /* décalé plus à gauche pour éviter le cadre */
        top:50%;
        transform:translateY(-50%);
        text-align:left; /* ALIGNÉ À GAUCHE comme demandé */
        pointer-events:none;
        z-index:10;
        max-width:200px; /* limite la largeur pour rester compact */
    }
    #instructions.visible{opacity:1;}

    /* === CADRE DE JEU AGRANDI === */
    #game-frame{
        width:832px;
        height:632px;
        position:relative;
    }
    #game{
        position:absolute;
        top:16px;
        left:16px;
        width:800px;
        height:600px;
        border:16px solid #ff1493;
        border-radius:36px;
        overflow:hidden;
        box-shadow:0 0 120px #ff1493,inset 0 0 90px rgba(255,20,147,0.8);
        background:#000;
    }
    #scene-svg,#character-svg{
        position:absolute;top:0;left:0;width:800px;height:600px;
    }
    #character-svg{z-index:10;pointer-events:none;}

    .heart{
        position:absolute;font-size:72px;color:#ff1493;
        text-shadow:0 0 45px #ff69b4;pointer-events:none;z-index:20;
        animation:fly 1.2s ease-out forwards;
    }
    @keyframes fly{
        to{
            transform:translate(var(--dx),var(--dy)) rotate(1080deg) scale(0);
            opacity:0;
        }
    }
</style>
</head>
<body>

<h1>LOVE MACHINE</h1>

<div id="input-zone">
    <label>Your inscription ID</label>
    <input type="text" id="inscriptionId" placeholder="paste your full ID + press Enter">
    <button onclick="loadInscription()">LOAD</button>
</div>

<div id="main">
    <div id="instructions">
        ← → Move<br>
        ↑ Jump<br>
        HOLD ENTER → SEND LOVE !
    </div>

    <div id="game-frame">
        <div id="game" tabindex="0">
            <svg id="scene-svg" viewBox="0 0 800 600"></svg>
            <svg id="character-svg" viewBox="0 0 800 600"></svg>
        </div>
    </div>
</div>

<script>
    const input = document.getElementById('inscriptionId');
    const sceneSvg = document.getElementById('scene-svg');
    const charSvg = document.getElementById('character-svg');
    const instructions = document.getElementById('instructions');
    const game = document.getElementById('game');

    let x = 0, y = 0, vy = 0, jumping = false;
    const keys = {};
    let lastShot = 0;

    const MIN_X = -700;
    const MAX_X = 700;

    async function loadInscription() {
        const id = input.value.trim();
        if (!id) return;

        try {
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://ordinals.com/content/' + id)}`;
            const resp = await fetch(proxyUrl);
            const data = await resp.json();
            let svgText = data.contents;

            svgText = svgText.replace(/href="\/content\//g, 'href="https://ordinals.com/content/');

            const parser = new DOMParser();
            const doc = parser.parseFromString(svgText, 'image/svg+xml');
            const images = doc.querySelectorAll('image');
            if (images.length < 6) return;

            const sceneHTML = Array.from(images).slice(0, -1).map(img => {
                const href = img.getAttribute('href');
                return `<image href="${href}" width="800" height="600"/>`;
            }).join('');

            const charHref = images[images.length - 1].getAttribute('href');

            sceneSvg.innerHTML = sceneHTML;
            charSvg.innerHTML = `
                <defs>
                    <mask id="mask">
                        <image href="${charHref}" width="800" height="600" style="filter:brightness(30);"/>
                    </mask>
                </defs>
                <image href="${charHref}" width="800" height="600" mask="url(#mask)"/>
            `;

            instructions.classList.add('visible');
            game.focus();
            x = 0; y = 0;

        } catch (e) { console.error(e); }
    }

    function shoot() {
        if (Date.now() - lastShot < 70) return;
        lastShot = Date.now();
        const h = document.createElement('div');
        h.className = 'heart';
        h.textContent = '♥';
        h.style.left = (410 + x) + 'px';
        h.style.top = (540 + y) + 'px';
        const a = Math.random() * Math.PI * 2;
        const p = 500 + Math.random() * 600;
        h.style.setProperty('--dx', Math.cos(a)*p + 'px');
        h.style.setProperty('--dy', Math.sin(a)*p + 'px');
        game.appendChild(h);
        setTimeout(() => h.remove(), 1300);
    }

    function loop() {
        if (keys.ArrowLeft) x -= 24;
        if (keys.ArrowRight) x += 24;
        x = Math.max(MIN_X, Math.min(MAX_X, x));

        if (jumping) {
            y += vy;
            vy += 1.1;
            if (y >= 0 && vy >= 0) { 
                y = 0; jumping = false; vy = 0; 
            }
        }

        if (keys.Enter) shoot();

        charSvg.style.transform = `translate(${x}px, ${y}px)`;
        requestAnimationFrame(loop);
    }

    game.addEventListener('keydown', e => {
        keys[e.code] = true;
        if (e.code === 'ArrowUp' && !jumping) { 
            jumping = true; 
            vy = -28;
            e.preventDefault(); 
        }
        if (e.code === 'Enter') e.preventDefault();
    });
    game.addEventListener('keyup', e => keys[e.code] = false);

    input.addEventListener('keypress', e => { if (e.key === 'Enter') loadInscription(); });

    requestAnimationFrame(loop);
</script>
</body>
</html>
